---
import Layout from "../layouts/Layout.astro";
import { Dashboard } from "../components/Dashboard";
import type { QuizzesListDTO } from "../types";

// Konfiguracja dla hybrid rendering - ta strona będzie server-side rendered
export const prerender = false;

// Pobranie listy quizów po stronie serwera
let quizzes: QuizzesListDTO = [];
let error: string | null = null;

try {
  const response = await fetch(`${Astro.url.origin}/api/quizzes`);

  if (response.ok) {
    quizzes = await response.json();
  } else {
    error = "Nie udało się pobrać listy quizów";
    console.error("Failed to fetch quizzes:", response.status);
  }
} catch (e) {
  error = "Błąd połączenia z serwerem";
  console.error("Failed to fetch quizzes:", e);
}
---

<Layout title="QuizCards - Panel Główny">
  {
    error ? (
      <div class="container mx-auto px-4 py-8 max-w-7xl">
        <div class="text-center py-12">
          <p class="text-destructive text-lg mb-2">{error}</p>
          <p class="text-muted-foreground text-sm">Odśwież stronę, aby spróbować ponownie</p>
        </div>
      </div>
    ) : (
      <Dashboard client:load initialQuizzes={quizzes} />
    )
  }
</Layout>
